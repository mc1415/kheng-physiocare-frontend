<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal - Kheng PhysioCare</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Styles specific to this portal simulation */
        body { background-color: var(--bg-light-gray); }
        .portal-container { max-width: 1100px; margin: 40px auto; padding: 20px; }
        .login-screen { max-width: 500px; margin: 40px auto; padding: 40px; background: white; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .dashboard-screen { display: none; } /* Hidden by default */
        #login-error { color: red; margin-top: 15px; font-weight: bold; }

        /* NEW DASHBOARD STYLES */
        .portal-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; /* Main column is wider */
            gap: 30px;
            align-items: flex-start;
        }
        .portal-card {
            background: #fff;
            border: 1px solid var(--border-color);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        .portal-card h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .appointment-item-detailed {
            background: var(--bg-light-gray);
            padding: 20px;
            border-radius: 5px;
            border-left: 5px solid var(--accent-green);
        }
        .appointment-item-detailed p { margin-bottom: 8px; }
        .appointment-item-detailed strong { color: var(--dark-text); }
        
        .todo-list { list-style: none; padding: 0; }
        .todo-list li { padding: 12px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .todo-list li:last-child { border-bottom: none; }
        .todo-list a:hover { text-decoration: underline; color: var(--accent-cyan); }

        .status-new {
            background: var(--accent-cyan);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .invoice-item {
             display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 10px;
        }
        .exercise-card { background: var(--bg-light-gray); padding: 20px; border-radius: 8px; margin-bottom: 15px; }

        /* Responsive adjustments for the portal grid */
        @media (max-width: 992px) {
            .portal-grid {
                grid-template-columns: 1fr; /* Stack columns on smaller screens */
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html"><img src="images/logo.jpg" alt="Kheng PhysioCare Logo" class="logo"></a>
        </div>
    </header>

    <div class="portal-container">
        <!-- =========== LOGIN SCREEN =========== -->
        <div id="login-screen" class="login-screen">
            <h1 class="section-title">Patient Portal Login</h1>
            <p>Please enter your credentials to access your file.</p>
            <form id="login-form" class="contact-form" style="max-width: 400px; margin: 30px auto;">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
                <p id="login-error" style="display: none;"></p>
            </form>
        </div>

        <!-- =========== DASHBOARD SCREEN (HIDDEN INITIALLY) =========== -->
        <div id="dashboard-screen" class="dashboard-screen">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; gap: 15px;">
                <h1 class="section-title" style="text-align: left; margin-bottom: 0;">Welcome, <span id="patient-name-display"></span>!</h1>
                <a href="#" onclick="logout()" class="btn btn-secondary">Logout</a>
            </div>

            <div class="portal-grid">
                <!-- Column 1: Primary Actions -->
                <div class="portal-main-column">
                    <div class="portal-card">
                        <h3>Your Next Appointment</h3>
                        <div id="next-appointment">
                            <!-- JS will populate this -->
                        </div>
                    </div>

                    <div class="portal-card">
                        <h3>Appointment History</h3>
                        <div id="appointment-history">
                            <!-- JS will populate this -->
                        </div>
                    </div>

                    <div class="portal-card">
                        <h3>Home Exercise Program</h3>
                        <p>Your latest exercises prescribed by your therapist. Consistency is key to recovery!</p>
                        <div id="exercise-list">
                            <!-- JS will populate this with latest exercises -->
                        </div>
                        <a href="#" style="font-weight:bold; margin-top:15px; display:inline-block; color: var(--primary-blue);">View Full Program →</a>
                    </div>
                </div>

                <!-- Column 2: Secondary Info & To-Do -->
                <div class="portal-side-column">
                    <div class="portal-card">
                        <h3>Things To Do</h3>
                        <ul id="todo-list" class="todo-list">
                            <!-- JS will populate this -->
                        </ul>
                    </div>
                    
                    <div class="portal-card">
                        <h3>Unpaid Invoices</h3>
                        <div id="unpaid-invoices-list">
                             <!-- JS populates this -->
                        </div>
                        <a href="#" style="font-weight:bold; margin-top:15px; display:inline-block; color: var(--primary-blue);">View All Billing History →</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.46.0/dist/umd/supabase.min.js"></script>
<script src="js/patient-portal.js"></script>

</body>
</html>